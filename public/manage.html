<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Manage Stories</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 1rem; line-height: 1.6; }
        h1 { text-align: center; }
        .story-list { max-width: 600px; margin: 1rem auto; }
        .story-item { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
        .pagination { display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem; }
        .search-wrapper { position: relative; max-width: 300px; margin: 0 auto 1rem; }
        .search-wrapper input { width: 100%; padding-left: 1.5rem; box-sizing: border-box; }
        .search-wrapper .icon { position: absolute; left: 0.25rem; top: 50%; transform: translateY(-50%); pointer-events: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script>
        const { useState, useEffect } = React;
        function App() {
            const [stories, setStories] = useState([]);
            const [page, setPage] = useState(1);
            const [total, setTotal] = useState(0);
            const [q, setQ] = useState('');

            const load = (p = page, search = q) => {
                fetch(`/stories/list?page=${p}&q=${encodeURIComponent(search)}`)
                    .then(res => res.json())
                    .then(data => {
                        setStories(data.stories);
                        setTotal(data.total);
                        setPage(p);
                    });
            };

            useEffect(() => load(1, q), []);

            const remove = async id => {
                if (!confirm('Are You Sure?')) return;
                const res = await fetch('/stories/' + id, { method: 'DELETE' });
                if (res.ok) {
                    load(page, q);
                } else {
                    alert('Failed to delete');
                }
            };

            const onSearch = e => {
                const value = e.target.value;
                setQ(value);
                load(1, value);
            };

            const totalPages = Math.ceil(total / 10) || 1;

            return React.createElement(React.Fragment, null, [
                React.createElement('h1', { key: 'h' }, 'Manage Stories'),
                React.createElement('div', { key: 'search', className: 'search-wrapper' }, [
                    React.createElement('span', { key: 'i', className: 'icon' }, '🔍'),
                    React.createElement('input', { key: 's', type: 'text', placeholder: 'Search', value: q, onChange: onSearch })
                ]),
                React.createElement('div', { key: 'list', className: 'story-list' }, stories.map(s =>
                    React.createElement('div', { key: s.id, className: 'story-item' }, [
                        React.createElement('span', { key: 't' + s.id }, s.title),
                        React.createElement('span', { key: 'a' + s.id }, [
                            React.createElement('button', { key: 'v', onClick: () => window.location.href = '/?id=' + s.id }, 'View'),
                            React.createElement('button', { key: 'e', onClick: () => window.location.href = '/edit.html?id=' + s.id }, 'Edit'),
                            React.createElement('button', { key: 'd', onClick: () => remove(s.id) }, 'Delete')
                        ])
                    ])
                )),
                React.createElement('div', { key: 'p', className: 'pagination' }, [
                    React.createElement('button', { key: 'prev', disabled: page <= 1, onClick: () => load(page - 1, q) }, 'Previous'),
                    React.createElement('span', { key: 'info' }, `Page ${page} of ${totalPages}`),
                    React.createElement('button', { key: 'next', disabled: page >= totalPages, onClick: () => load(page + 1, q) }, 'Next')
                ])
            ]);
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
